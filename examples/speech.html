<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Speech</title>
</head>

<body>
	<h3>Speech Recognition</h3>
	<div class="words" contenteditable>
	</div>

	<script>

		var comidas = [
			{
				nombre:"br√≥coli",
				KCALxGR:20,
				proteinaGR:5,
				hidratosGR:80,
				grasaGR:0
			},
			{
				nombre:"pollo",
				KCALxGR:100,
				proteinaGR:80,
				hidratosGR:5,
				grasaGR:0
			},
			{
				nombre:"aceite",
				KCALxGR:100,
				proteinaGR:0,
				hidratosGR:0,
				grasaGR:100
			}
		]

		window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

		const recognition = new SpeechRecognition();
		// recognition.interimResults = true;
		recognition.lang = 'es-ES';

		let p = document.createElement('p');
		const words = document.querySelector('.words');
		words.appendChild(p);

		recognition.addEventListener('result', e => {

			const transcript = Array.from(e.results)
			.map(result => result[0])
			.map(result => result.transcript)
			.join('');


			// const poopScript = transcript.replace(/caca|sorete|tereso|deposici√≥n/gi, 'üí©');
			// p.textContent = poopScript;
			
			


			if (e.results[0].isFinal) { 
				var match = comidas.find(comida =>{
					return comida.nombre == transcript;
				})
				if(match){
					p.textContent = match.nombre + " " + match.KCALxGR +" calorias " 

				}
				else{
					p.textContent = "qu√© lo que?"
				}
				p = document.createElement('p');
					words.appendChild(p);
			}
		});
	
		recognition.addEventListener('end', recognition.start);	//empezar de nuevo automaticamente

		recognition.start();


		recognition.onerror = function (event) {
			console.log(event.error);
		};
	</script>


	<style>
		body{
			background: #dddddd
		}
		.words {
			max-width: 500px;
			padding: 10px;
		}
	</style>

</body>

</html>