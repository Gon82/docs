<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Speech</title>
</head>
<style>
	body{
		background: #dddddd
	}
	.container {
		max-width: 500px;
		padding: 10px;
	}
	.match{
		color: green
	}
</style>



<body>
	<h3>¿Qué tu quieres comer?</h3>
	<div class="container" contenteditable>
	</div>

<script>

var comidas = [
	{ nombre:"brócoli", KCALxGR:20, proteinaGR:5, hidratosGR:80, grasaGR:0 }, 
	{ nombre:"pollo", KCALxGR:100, proteinaGR:80, hidratosGR:5, grasaGR:0 },
	{ nombre:"aceite", KCALxGR:100, proteinaGR:0, hidratosGR:0, grasaGR:100 }
]

window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();
recognition.interimResults = true;
recognition.lang = 'es-ES';

//on error
recognition.onerror = function (event) {
	console.log(event.error);
};


let p = document.createElement('p');
const container = document.querySelector('.container');
container.appendChild(p);
let matchFlag = false

recognition.addEventListener('result', e => {
	
		const transcript = Array.from(e.results)
		.map(result => result[0])
		.map(result => result.transcript)
		.join('');

		p.textContent = transcript;		

		if (e.results[0].isFinal) {
			
			var match = comidas.find(comida =>{
				return comida.nombre == transcript;
			})
			
			if(match && !matchFlag){
				foodMached(match)
				console.log(matchFlag)	
			}
			else if  (matchFlag){
				
				if (transcript == 'calorías' || transcript == 'caloría'){
					console.log('kcal')
				}
				if (transcript == 'gramos' || transcript == 'gramo'){
					console.log('gramos')
				}
				matchFlag = false
			}
			else{
				nofoodMached()		
			}	
		}
});

recognition.start();
recognition.addEventListener('end', recognition.start);



function foodMached(match){

	p.textContent = match.nombre + " " + match.KCALxGR +" calorias "
	matchFlag = true;

	//render
	p.classList.add('match')
	p = document.createElement('p');
	container.appendChild(p);	
}

function nofoodMached(){
	p.textContent = "⚠️ No encontrado"
	//render
	container.appendChild(p);

}

</script>







</body>

</html>